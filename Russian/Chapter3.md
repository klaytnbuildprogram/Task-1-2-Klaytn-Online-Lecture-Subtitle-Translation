# 3. Понимание "Klaytn"

## 3.1 Консенсус
 
 
 
В предыдущих главах мы обсуждали проблемы существующих блокчейнов. Давайте поговорим о том, как блокчейн Klaytn решает проблемы, используя алгоритм консенсуса. Существует много типов алгоритмов консенсуса, таких как PoW (Proof-of-Work) или PoS (Proof-of-Stake), которые обычно используются в общедоступных блокчейнах, и PBFT (Practical Byzantine Fault Tolerance) или Raft, которые используются в частных блокчейнах. В целом, частные блокчейны могут достигать соглашения более эффективно, чем публичные блокчейны. В частности, частные блокчейны на основе BFT могут достигать высокой производительности и эффективности путем ограничения количества участвующих нод. Однако эта конфигурация ограничивает количество нод, ослабляет децентрализацию, и содержание согласованных результатов раскрывается только для небольших групп. В результате это ограничивает прозрачность и вредит преимуществам блокчейна.

С другой стороны, Klaytn выбирает Istanbul BFT в качестве алгоритма консенсуса, поскольку считает, что, используя преимущества BFT, он может сочетать как преимущества публичной, так и частной версии блокчейнов. Он нацелен на создание публичного блокчейна, который обеспечивает производительность и стабильность для крупных предприятий при сохранении высокой безопасности и прозрачности. Чтобы достичь этой цели, Klaytn использует доверительную модель частного консенсуса с публичным раскрытием. Модель состоит из небольшого количества частных нод, которые достигают консенсуса, и других узлов, которые могут публично получать доступ и проверять результат генерации блока. Теперь давайте посмотрим больше на Istanbul BFT (Byzantine Fault Tolerance), которую Klaytn использует в качестве алгоритма консенсуса.
 

 
 
Istanbul BFT имеет трехэтапный процесс консенсуса. Есть предварительная подготовка, основная подготовка и совершение шагов. Klaytn использует метод циклического перебора, с целью выбирать исполнителя (proposer) среди узлов консенсуса каждый раунд. Эта нода назначается исполнителем. Остальные ноды консенсуса являются валидаторами. И делают проверку.
 
Если вы посмотрите на картинку, там есть proposer, validator 1, 2, 3 и так далее. Среди них узел, помеченный X, находится в статусе, в котором он в настоящее время характеризуется неисправным состоянием. Это означает, что он не функционирует должным образом как верификатор. Когда компьютер сломан, сеть отключена, или компьютер работает злонамеренно, такие вещи случаются.
 
Первый шаг - это «propose», в котором один из узлов консенсуса выбирается в качестве исполнителя.
Вторым этапом является предварительная подготовка, когда узел-исполнитель создает блоки и делает предложения другим узлам.
Затем отправляет предложение узлу валидатора 1, отправляет узлу валидатора 2 и отправляет узлу валидатора 3.
На этом этапе, передача происходит вместе с сообщением.
 
 
 
На третьем этапе подготовки, когда узлы валидатора 1, 2 или 3 получают сообщение от исполнителя, они отправляют сообщения о том, что они успешно получили сообщение, другим узлам. Узел валидатора 1 отправляет сообщение всем трем узлам, а узел валидатора 2 также отправляет сообщение всем трем узлам.
Однако узел валидатора 3 ничего не отправляет и просто получает сообщения, потому что он в данный момент неисправен.
 
В конце состояния подготовки вы можете увидеть, сколько узлов в системе. Подобно этому изображению, мы видим, что все три успешны: исполнитель, валидатор 1 и валидатор 2.
Этот процесс гарантирует, что все валидаторы находятся в одном раунде.
 
 
 
 
Наконец, на этапе фиксации, происходит процесс связи с другими узлами, с целью решить, принимать ли блок, полученный от исполнителя. Например, он отправляет ответ на узлы, чтобы проверить, в порядке или нет блоки от исполнителя. Если узлы в количестве более двух третей согласны, блок будет немедленно утвержден. В конце концов, это решается на этапе фиксации, и формируется окончательный результат. То есть отсутствия завершенности не существует и на этом этапе формируется неизменное конечное состояние. Это не промежуточное состояние, как в PoW.
 
Таким образом, преимущество заключается в том, что коммуникация сразу приводит к консенсусу и полноте. Однако существует недостаток, заключающийся в том, что трафик увеличивается экспоненциально по мере увеличения количества узлов. Эта часть настроена так, чтобы выбирать только часть узлов консенсуса  и поддерживать форму BFT.
 
Давайте посмотрим, как создается и распространяется блок в следующем уроке.
 
## 3.2 Генерация и распространение блока 
Давайте посмотрим, как Klaytn создает и распространяет блоки, чтобы получить качественный пользовательский опыт.
 
Давайте сначала посмотрим на цикл создания блока. Цикл создания блока КлKlaytnайтна называется «раунд», и каждый раунд создается новый блок, новый раунд начинается, как только заканчивается предыдущий. Интервал создания блока занимает около 1 секунды.



Давайте посмотрим, как работает выбор исполнителя и комитета.
В каждом раунде лицо, предлагающее генерировать блок, выбирается из одного из узлов случайным образом. Совет управления представляет собой совокупность основных ячеек или узлов консенсуса. Если вы посмотрите на изображение, эти круги являются узлами консенсуса, из которых нода синего цвета была выбрана в качестве исполнителя текущего раунда. А затем выбирается другая группа узлов консенсуса в качестве комитета этого раунда. Узлы валидаторы помечены розовым цветом, они выбираются комитетом. Более конкретно, каждый согласованный узел использует случайное число, полученное из самого последнего заголовка блока, для выполнения криптографической операции, с целью доказать, что он был выбран для этого раунда.
 


Давайте посмотрим на формирование блока и проверки.
Когда узел консенсуса выбран в качестве исполнителя, он уведомит другие узлы о том, что он был выбран в качестве исполнителя в раунде. В настоящее время это будет доказано криптодоказательством, которое можно проверить с помощью открытого ключа автора. Затем группа узлов консенсуса, которая избирается в комитет в этом раунде, также присылают исполнителю сообщение с доказательствами,  они были выбраны в качестве члена комитета. (Нажмите) Теперь, когда вы знаете, кто является инициатором и комитетом, исполнитель выбирает и сортирует транзакции в пуле транзакций и создает блоки. Затем он соглашается с комитетом, соглашается с вновь созданным блоком и заканчивает работу.
 

Наконец, давайте посмотрим на распространение блоков.
Предлагаемый блок должен быть подписан двумя третями членов комитета для успешного завершения. Когда комитет достигает соглашения, новый блок доставляется всем узлам консенсуса, и этап согласования заканчивается. Затем вы можете распространить блок на узлы конечных точек через прокси-узел (Нажмите).
Пока что мы пришли к пониманию того, как вбираются исполнители и комитеты для генерации и распространения блоков.

 
 

## 3.3 Структура сети
 
Давайте кратко  объясним структуру сети Klaytn. Слева приведена краткая версия сети. Во всей сети имеется сеть базовых ячеек, эта сеть базовых ячеек окружает endpoint node. Если вы сделаете увеличение, внутри красного поля находится сеть базовой ячейки, а синее поле снаружи является сетью конечных точек. В базовой  сети желтая часть - это сеть CNN, сеть узлов консенсуса, а красная - сеть PNN, сеть прокси-узлов. CN в желтом цвете будет отвечать за консенсус.
 
 
 
Одна основная ячейка управляется одним участником. Он работает с одним CN и несколькими прокси-узлами, подключенными к CN. Чтобы участвовать в CN, вы должны согласиться с жесткими условиями. И все CN связаны вместе, чтобы они могли общаться друг с другом. Если есть 10 CN, они связаны друг с другом. Все это связано, потому что они должны общаться друг с другом так быстро, насколько это возможно, когда они находятся в процессе консенсуса. CN не могут напрямую контактировать с внешним миром. Поскольку это очень частная среда без помех, у нее есть преимущество в том, что она может быстро решить, делать ли блок или нет, как консенсусный узел. Итак, как мы подходим к этому? Как участник основной ячейки, вы управляете своей прокси-сетью, которой можете управлять и доверять, можете представлять их.
 
А снаружи узлы конечных точек подключены к базовой  сети. Эти конечные узлы могут подключаться к прокси-узлу в базовой ячейке для получения информации. Конечно, узлы конечных точек могут соединяться и обмениваться информацией друг с другом. Однако, если узел конечной точки подключается к прокси-узлу, вы можете получить блок быстрее. Обратите внимание, что нет необходимости быть узлом конечной точки. Любой может быть узлом конечной точки и передавать информацию таким клиентам, как Интернет или мобильный телефон. Это узел конечной точки, который действует как поставщик услуг.
 
 
И снова у вас есть загрузочный узел CN, примечание о загрузке PN и загрузочный узел EN, который является узлом особого типа, управляемым Klaytn, который помогает новым узлам регистрироваться в сети и подключаться к другому узлу. Загрузочный узел CN находится внутри сети CN и не публикуется. Загрузочные узлы PN и EN являются открытыми узлами. Загрузочные узлы PN позволяют регистрировать только разрешенные прокси-узлы и помогают подключаться к узлам конечных точек. Загрузочный узел EN предоставляет информацию конечным узлам о том, к какому прокси-узлу подключаться. Итак, мы кратко рассмотрели структуру сети Klaytn.
 
## 3.4 Базовая сеть
 

 
 
Давайте поговорим о базовой сети. Когда будет запущена основная сеть, в основной ячейке, отвечающей за консенсус, будет работать несколько десятков единиц. Как  улучшить сервисы, что мы должны делать с точки зрения масштабируемости, если становится все больше подключений к основной ячейке?
В общем случае, не касательно блокчейн, в связи с ростом числа пльзователей, мы будем расширять сервер и разбивать запросы. Однако в случае блокчейна увеличение количества узлов может замедлить скорость обработки, поскольку по мере роста необходимо передавать больше информации каждому узлу. Увеличение количества узлов не увеличивает производительность. Таким образом, вместо того, чтобы увеличивать количество узлов, правильным способом является увеличение производительности самого узла. Например, вы можете увеличить производительность ОЗУ или ЦП. Давайте посмотрим на условия для присоединения в качестве узла консенсуса. Выступление участника требует
 
 
1. Более 40 физических ядер
2. 256 ГБ ОЗУ
3. Сохранение примерно 14 ТБ данных за один год
4. сеть 10G
 
 
 
Обратите внимание, что высокая производительность одного из консенсусных узлов участника не означает высокую скорость всей сети базовых ячеек. Потому что остальные узлы с более низкой производительностью работают с более низкими техническими характеристиками. Поэтому, чтобы улучшить производительность основной ячейки, необходимо соответствовать тем же спецификациям.
 
 
 
 
И, снова взглянув на структуру основной ячейки, можно увидеть, что она состоит из одного CN и нескольких PN. Есть несколько причин, почему прокси-узел называется PN. Поскольку CN имеет ограниченные ресурсы для подключения, а количество CN ограничено, он поддерживает подключение конечных точек с использованием PN. Например, предположим, что узлы конечных точек могут подключаться напрямую к CN. Если этот CN может принять до тысячи подключений к конечной точке, то, если он выйдет за пределы этого, он будет перегружен, и его производительность может дать сбой. Так что PN делает эту часть вместо CN. PN соединяется с узлами конечной точки и передает транзиты в CN. А поскольку CN нужно подключиться только к нескольким PN, это гораздо менее обременительно, и вы можете решить проблемы с подключением конечных точек, пытающихся подключиться к базовой ячейке, путем размещения нескольких PN.
 
Подводя итог, можно сказать, что, поскольку CN является узлом, ответственным за консенсус, соединение не должно быть помехой производительности. Таким образом, роль PN заключается в защите CN, и проблема масштабируемости может быть решена путем размещения нескольких PN.
 
 
 
 
 
 
## 3.5 Сервисная цепь
 



 
Сервисная цепь Klaytn - это независимый блокчейн, подключенный к сети. Эта идея исходит из требований масштабируемости. В ситуации, когда вы хотите использовать сервисная цепь, вам нужно установить ее в специальной среде узлов или если вы хотите настроить уровень безопасности, например, когда вы хотите запустить приватный блокчейн. Услуги, которые требуют огромной пропускной способности. Когда экономически невозможно распределить услуги по сети, используют сервисную цепь.
 
Если вы посмотрите на изображение, большой круг в центре - это сеть. Можно видеть, что сервисная цепь доверяет главной цепи, которая не может свободно взаимодействовать между главной цепью и сервисной цепью, и могут использоваться только ограниченные транзакции. Кроме того, передача KLAY будет разрешена только при наличии более поздних ограничений.
 
 
 
 
 
Другими словами, сервисная цепочка создает отдельное сервисное пространство и при необходимости блокирует консенсус в основной сети. Другие платформы блокчейна также переходят на внедрение таких технологий, как сервисные цепи. В случае Ethereum я ощущал ограничения основной сети с точки зрения емкости и скорости. Хорошо известно, что игра Crypto Kitty, которая когда-то произвела огромный бум, замедлила работу основной сети Ethereum. Так, на стороне Ethereum они выдвигают концепцию, основанную на технологии боковой цепи под названием Plasma, которая, если все сделано правильно, уменьшит нагрузку на основную цепь и позволит обрабатывать больше транзакций в секунду. Но это все еще в проектах.
 
Кстати, в сервисной цепи Klaytn вы можете установить нулевую плату за газ для всех транзакций. Это означает, что разработчики BApp или поставщики услуг могут создавать свою собственную среду и предоставлять услуги пользователям в сервисной цепи. Да, я говорил о том, что такое сервисная цепь Klaytn.
 
 
 
 
 
 

## 3.6 Разница между Klaytn и Ethereum - разные роли нод
 
 
Давайте вкратце поговорим о разнице между Klaytn и Ethereum.
 
Ethereum - это единая сеть. Нет различий между участниками сети. Любой может создать блок, но когда дело доходит до создания блока, человек должен быть первым, кто уведомит, что он сделал это первым, и что это должно стать известно во многих местах.
Поэтому, если вы добавите блок в блокчейн, вы получите компенсацию.
Это PoW, метод доказательства работы, используемый Ethereum в качестве протокола консенсуса.
 
 
В Ethereum вам нужно придерживаться как можно большего количества нод, потому что вы не знаете, кто будет узлом добычи блоков.
Другими словами, ноды, которые пишут блоки, имеют актуальную информацию.
Я хочу быстро получить информацию, но я не знаю, где находится этот узел.
Если вы знаете, что узел A всегда быстрее всего записывает блок, вам нужно только придерживаться этого узла A, тогда вы сможете быстрее получать информацию.
 
Однако, поскольку Ethereum всегда меняет свой узел, вам нужно придерживаться как можно большего числа узлов, рассылая запросы как можно большему количеству узлов.
 
 
Тогда это даст вам возможность получить самую свежую информацию.
Поскольку любой узел может записывать и распространять блоки, вам необходимо подключиться к как можно большему количеству узлов, чтобы получить самые последние данные.
 
Klaytn, с другой стороны, не отдельная сеть, а сеть с двумя уровнями.
Я сказал, что один из узлов консенсуса в базовой сотовой сети будет выбран в качестве исполнителяи будет играть роль генератора блока в этом раунде.
Итак, как вы получаете последнюю информацию?
Я должен быть поблизости.
Узлы конечной точки, прикрепленные к базовой ячейке, знают, что узлы консенсуса являются эмитентами блоков, поэтому они присоединяются к CN.
 
 
Таким образом, вы можете загрузить или передать достоверную информацию.
Когда мы создаем приложение, мы создаем серверы, которые показаны здесь.
Вы можете развернуть Java или SQL DB на облачных или частных серверах, таких как Azure или AWS.
Однако, поскольку этот сервер не может быть напрямую связан с основной ячейкой, сначала необходимо подключиться к узлу конечной точки, чтобы получить доступ к данным блокчейна.
Вы можете подключить свой компьютер к узлу конечной точки или использовать его для подключения к другому узлу конечной точки.
Однако лично запустить этот конечный узел нелегко.
Поскольку система блокчейнов должна синхронизировать все узлы при своей работе, она должна синхронизироваться каждый раз, когда добавляются новые блоки, для правильной их записи.
 
 
 
 
 
 
Кроме того, существует также опасение, что компьютер может быть скомпроментирован при атаке.
ПРи наличии этих проблем вы можете подключиться к доверенному внешнему узлу, такому как узел инфраструктуры Ethereum.
Например, у вас есть веб-разработчик. Он хочет подключиться к Klaytn и просто прочитать данные. Тогда лучше подключиться к внешнему общедоступному узлу и использовать его, чтобы сделать этот процесс намного проще и менее трудоемким, чем запуск личного узла конечной точки.
 
Наконец, в отличие от Ethereum, существует сервисная цепь, которая может частично обмениваться данными с основной сетью и создает отдельное сервисное пространство.
Подводя итог, можно сказать, что Klaytn - это сеть, в которой два уровня доверяют друг другу, и при доступе к внутренней цепочке блоков узел конечной точки может подключаться к сети базовой ячейки и быстро записывать или получать данные.


