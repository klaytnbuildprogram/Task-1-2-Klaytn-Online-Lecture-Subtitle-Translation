# 4. Разработка игры в Klaytn Tools
## 4.1 Введение
 

Всем привет. В этом уроке я попытаюсь разработать BApp, в виде простой игры-приложения, используя блокчейн Klaytn. Для справки, BApp является аббревиатурой от Blockchain Applications. Давайте создадим простую игру, которая бесплатно переведет 0,1 Klay, если вы решите задачку на сложение за 3 секунды.
 
 
Давайте посмотрим, как это работает. Сначала войдите в учетную запись оператора. Мы проверяем аккаунт, используя комбинацию файла хранилища ключей и пароля. Поэтому выберите файл хранилища ключей и введите пароль. Как только учетная запись будет подтверждена, используйте кнопку «Send KLAY to Contract», чтобы установить общую сумму, которая будет использоваться для этого события. Причина, по которой мы отправляем KLAY на адрес контракта, заключается в том, что нужно показывать пользователю сумму денег, которая будет использована для этого события, и делать это доступным способом. Обратите внимание, что это может быть сделано только в учетной записи оператора.


Сейчас я отправляю деньги на контракт. Я отправляю около 1 KLAY. После завершения транзакции пользователю будет показана сумма, потраченная на событие. Теперь пользователи могут начать игру. Если вы решите задачу в течение 3 секунд, 0,1 KLAY из контракта будет отправлено на учетную запись пользователя. Давайте начнем.
Если при этом решение окажется неправильным, оно будет сброшено. Если вы попытаетесь снова, и если вы решите задачу, вы можете получить KLAY, нажав кнопку OK. Когда транзакция завершена, баланс в контракте сокращается на 0,1. Как видите, обработка транзакций очень быстрая. Это сильная сторона Klaytn. Если вы нажмете на ссылку ниже, вы попадете в рабочую среду Klaytn, где вы сможете увидеть информацию о только что созданной транзакции.


Если у вас есть опыт разработки Ethereum DApp, предстоящий курс будет для вас довольно простым. Klaytn - это платформа, созданная Byzantine версией Ethereum, поэтому вы будете чувствовать себя уверенно, во многих отношениях. Например, библиотека JavaScript, caver.js, которая может взаимодействовать с блокчейном Klaytn, похожа на Ethereum web3.js. Кроме того, мы поддерживаем языки solidity, наиболее часто используемые для разработки интеллектуальных контрактов.


Поскольку он использует инфраструктуру Truffle, вы можете быстро адаптироваться к разработке BApp. Те, у кого нет опыта разработки BApp, могут разработать BApp на платформе блокчейна Klaytn с помощью этого урока. Но, прежде всего, хорошо бы понять базовую составляющую solidity, который является языком разработки смартконтрактов. Я оставил ссылку, это можно изучить.
Да, мы собираемся работать с некоторыми инструментами, которые поддерживают Klaytn,
Во-первых, я использую IDE, которая может тестировать разработки, кошелек, который может управлять учетными записями.
и Klaytn scope, поисковую систему для поиска информации о транзакциях.

 
 
## 4.2 Кошелек Klaytn и управление аккаунтами
 

Чтобы использовать блокчейн, вы должны иметь свою учетную запись. Вам нужен кошелек для управления токенами KLAY. Так что я собираюсь использовать кошелек Klaytn. Он удобный и очень простой в использовании. https://baobab.klaytnwallet.com/ Если вы перейдете по этому адресу, вы можете подключиться к сети Baobab и создать свою учетную запись и управлять ею. Для справки, этот кошелек предназначен для тестирования, а используемый в нем Klay не имеет денежной ценности. Сначала давайте создадим новую учетную запись. Нажмите Create a new wallet. Это процесс, который создает файл пароля и хранилища ключей. Перед этим я объясню, что такое файл хранилища ключей. Это как будто мы идем в банк, чтобы получить чековую книжку, и положить эту чековую книжку в сейф, чтобы другие не могли ее использовать. Это хранилище представляет собой комбинацию файла хранилища ключей и пароля, которая защищает секретный ключ, необходимый для подписания транзакции, от хакеров и внешних вторжений.


Теперь давайте продолжим и создадим файл хранилища ключей. Введите здесь свой пароль, нажмите следующий шаг и загрузите файл хранилища ключей. Сделано.
Затем я дам команду сохранить где-нибудь свой секретный ключ. Секретный ключ является обязательным требованием для подписания транзакции в Klaytn BApp. Этот секретный ключ никогда не должен быть доступен извне. Это все равно, что скомпроментаровать банковские пароли и потерять все деньги.
 


Вот почему я создаю файл хранилища ключей для защиты своего секретного ключа. Файл хранилища ключей и пароль хранилища ключей должны быть известны до доступа к секретному ключу. Даже если хакер получит файл хранилища ключей, секретный ключ не будет доступен без пароля. Таким образом, хакер не может получить деньги. Это не значит, что вы можете легко публиковать хранилище ключей. Не подвергайте его риску.
Теперь я сохраню этот секретный ключ в блокноте. Вы не должны этого делать, но это всего лишь тестовая сеть, и я сделаю это для удобства работы. Вы должны сохранить свой закрытый ключ в безопасном месте. После сохранения нажмите на информацию о кошельке слева. Теперь я могу получить доступ к своему кошельку. Есть два способа войти в него. Первый - использовать секретный ключ, а второй - доступ к файлу хранилища ключей и паролю. Во-первых, давайте получим доступ к нему с помощью секретного ключа. Скопируйте и вставьте его в блокнот.

 
Информация о моем кошельке стала доступна. Ниже приведен публичный адрес моей учетной записи и мой секретный ключ. Я вижу свой список транзакций. Мне не нужно смотреть в эту часть, потому что я еще не создал транзакцию. С правой стороны я вижу, сколько у меня KLAY, и я также могу добавить токены в свой кошелек, нажав кнопку «плюс».
 
Теперь давайте получим KLAY на счет. Нажмите на вкладку KLAY, чтобы получить бесплатные монеты Klay. Мой текущий адрес аккаунта имеет нулевой баланс. Если вы нажмете кнопку «Run faucet», вы получите 5 KLAYs. Получив Klay, вы можете получить их снова через 24 часа. Поскольку вы не можете получить много KLAY за короткое время, вы должны разделить KLAY при тестировании. Причина, по которой мы получаем его через 24 часа, заключается в том, что некоторые люди, использующие KLAY, могут его злонамеренно использовать. Klaytn считает, что они занимаются мошенничеством, так будет лучше. Теперь давайте перенесем KLAY в другой аккаунт. 
 
 


Если вы перейдете на вкладку Send klay & token, вы можете отправить деньги со своего адреса на другой адрес. Введите адрес получателя. Я собираюсь отправить KLAY, нужно посмотреть вниз чтобы решить, сколько потратить. Там говорится, что 0,000625 KLAY будет нижним пределом комиссии за транзакцию. Это похоже на оплату комиссионного вознаграждения. Процедура вычисления этой суммы - цена газа, умноженная на лимит газа. Вы можете думать о цене на газ как о деньгах, которые платятся за запрос транзакции к узлу консенсуса. Цена газа Klaytn всегда фиксирована, в отличие от Эфириума. Трудно предсказать общую комиссионную стоимость, потому что цена на газ Эфириума колеблется. Тем не менее, цена газа Klaytn всегда установлена ​​на уровне 25 ston, независимо от того, какую транзакцию вы обрабатываете.

 

Лимит газа - это максимальная стоимость газа, имеющего отношение к этой транзакции. Например, предположим, что в этой транзакции, которую мы отправляем, есть какой-то бесконечный цикл. Затем эта транзакция продолжит работу в сети. Это приводит к снижению производительности сети. Вы не должны создавать всеобщие проблемы. Итак, если у вас более 25 000 газа, Клайтн считает, что это нечто странное, и он прекращает обработку.



Я сказал, что цена на газ составляет 25 test_ston, ston является одной из денежных единиц KLAY. Точно так же, как доллар в Соединенных Штатах составляет 100 центов, есть много единиц KLAY. https://docs.klaytn.com/klaytn/design/computation/exec_model В официальном документе Klaytn показаны единицы измерения KLAY. Есть много градаци. В середине находится стандартная единица KLAY, а колышек сверху - это минимальная единица, представляющая KLAY. Величина, которое используется для десятичности peb это ston. Как 25 ston перевести в KLAY? https://blockchains.tools/pebConverter?l=KLAY Если вы зайдете на этот сайт, можно конвертировать все единицы. Если вы поставите 25 Ston, посмотрите, сколько KLAY мы получаем. Если на это умножить газовый лимит 25000, выйдет 0,000625 KLAY. Используется в качестве комиссии за транзакцию. Давайте прокалькулируем. Если вы скопируете это и умножите на газовый лимит калькулятора 25000, будет получена стоимость транзакции. Это стоимость обработки транзакции.


Обратите внимание, что когда вы отправляете простые денежные переводы в Klaytn, стоимость транзакции всегда устанавливается равной 0,000625 KLAY. Тем не менее, стоимость транзакции не фиксируется в транзакции с помощью функции смартконтракта, поскольку лимит газа изменяется в зависимости от сложности транзакции. Я поясню это позже.
 
Вы можете вручную изменить цену, нажав кнопку «Изменить» рядом с ней. Но я рекомендую вам использовать настройку по умолчанию.
Попробуем сейчас отправить транзакцию. На следующей странице вы увидите информацию о том, сколько вы отправляете респонденту и сколько будут стоить транзакции. Нажмите «Да» на вопрос «Хотите продолжить?». Тогда транзакция будет завершена в мгновение ока. Затем нажмите на просмотр информации о транзакции, и сумма, которую мы отправим, будет сохранена в блоке и показана пользователю. Я объясню позже более подробно. Итак я использовал Klaytn Wallet.

 

## 4.3 Klaytn IDE и смартконтракт 1
 
С помощью IDE от Klaytn, мы будем создавать простой смартконтракт для нашего приложения. Вместо того, чтобы сосредоточиться на смартконтрактах, я собираюсь сосредоточиться на инструментах Klaytn.
Вы можете создавать и тестировать самртконтракты, посетив http://ide.klaytn.net/. Система похожа на ремикс IDE Ethereum, но здесь она используется для подключения к ноде Klaytn, а не к ноде Ethereum. Теперь давайте посмотрим на возможности Klaytn IDE, создав собственные смартконтракты для наших игр.
 
Для справки, умный договор называется smart contract на английском языке. Я собираюсь назвать его «Contract» в моей лекции. Если вы посмотрите здесь, у вас уже есть расчетный контракт, созданный по умолчанию. Я сотру его и начну. Пожалуйста, удалите содержимое. И, как вы можете видеть в комментариях вверху, Klaytn IDE использует версию Solidity 0.4.24, поэтому вам нужно перейти к этой версии.
 
Наш контракт имеет три функции. Первый - отправить KLAY в контракт, второй - загрузить остаток по контракту и, наконец, функцию отправки KLAY из контракта на учетную запись пользователя. Мы сделаем шаги один за другим и используем инструменты для проверки. Во-первых, давайте назовем контракт как AdditionGame, игру Contract Edition.
 
(Code)
В момент развертывания вы создаете переменную состояния, в которой может храниться адрес учетной записи оператора. Я создаю конструктор. Что обычно делает конструктор? Да. Он в первую очередь отвечает за инициализацию. В случае solidity, вы не можете снова написать или загрузить конструктор, тем более что именно конструктор загружается первым при развертывании. Я могу воспользоваться этим и создать учетную запись для владельца контракта. Сначала мы создаем владельца переменной состояния. Он является типом адреса. Я строю конструктор. Владелец это Msg.sender.
 
(Code)
Я только что создал конструктор. msg.sender - это человек, который в настоящее время вызывает этот контракт. Msg.sender в конструкторе означает учетную запись, используемую для развертывания. Итак, я назначу эту учетную запись переменной состояния владельца и запишу ее в блокчейн. Это инициализация. Итак, давайте проверим код, который мы только что добавили. Но сначала Вы должны скомпилировать. Установите флажок «Авто» в верхней части правой панели, чтобы автоматически компилировать каждый раз, когда вы пишете код. Сначала вы должны нажать на кнопку компиляции, чтобы увидеть, работает ли она. Да, скомпилированная информация находится внизу. Давайте снова установим рабочую среду. Среда имеет несколько вариантов на выбор: DEV NODE и Baobab. И я могу добавить новую сеть. Функция Add New Network подключается к адресу RPC, где в данный момент работает узел Klaytn, и проверяет его. На данном этапе я пропущу эту часть. Узел разработки - это опция для подключения и тестирования узла, предоставляемого Klaytn. Он создает случайную учетную запись и позволяет предварительно получить 100 KLAYs. И он собирается использовать газ для тестирования. Таким образом, как вы видите ниже, в этом аккаунте уже есть 100 тестовых KLAY. Возможность подключения к Baobab также включена в официальной тестовой сети. И в тот момент, когда вы выбираете Baobab, KLAY в учетной записи ниже меняется на ноль. Dev-узлы и Baobab-узлы работают независимо друг от друга, поэтому учетные записи по одному и тому же адресу распознаются друг другом, но состояние учетной записи отличается, поскольку узлы разные. Так что баланс изменится.
 
 
Попробуем обновить страницу с выбранным узлом Dev. Далее, в разделе «Загрузка учетной записи», я не использовал ранее ни одной учетной записи, и я создаю другую новую учетную запись. Самое смешное, что вы можете загрузить эту учетную запись в виде отдельного файла хранилища ключей или секретного ключа и использовать ее повторно. Если вы тестируете на другом компьютере, вы можете продолжить использовать учетную запись, которую вы уже применяли. Вы можете использовать эту опцию в нужное время. Например, если вы нажимаете на учетную запись, у вас есть резервная копия текущей учетной записи. Когда вы выбираете ее, открывается окно, и у вас есть возможность получить хранилище ключей или секретный ключ. Просто сделайте резервную копию своего секретного ключа. Когда вы нажали «Копировать в буфер обмена», вы создали резервную копию секретного ключа для этой учетной записи.
 
 
Затем обновите страницу. Как только учетная запись будет создана, нажмите еще раз и выберите вариант импорта учетной записи. Перейдите на вкладку «Закрытый ключ» и вставьте резервный секретный ключ. Ярлык будет называться тестовой учетной записью. Импортируйте. Если вы снова выберите учетную запись, у вас будет тестовая учетная запись, которую мы импортировали ниже. Поэтому, когда вы возвращаетесь на эту страницу на другом компьютере, вы можете последовательно выполнять тестирование.
 
 
Вместо того, чтобы объяснять Tx Value, я постараюсь сначала развернуть его. Разворачиваю
. После того, как вы нажмете кнопку компиляции, у вас есть возможность развернуть нашу AdditionGame. Нажмите развернуть. Развертывание было завершено менее чем за 3 секунды. На панели есть хэш TX, верно? Это информация о транзакционном хеше, созданная при развертывании. Кроме того, он показывает, по какому адресу был развернут контракт.
 
 
Если вы посмотрите на панель, вы увидите, по какому адресу в настоящее время развернут контракт, и ниже у вас есть возможность загрузить значение переменной состояния владельца. Это функция получения. Поскольку мы объявили общедоступной переменной-владельца, мы можем автоматически сгенерировать функцию-получатель, чтобы получить значение переменной-владельца. Когда вы нажимаете кнопку вызова, ниже появляется адрес. Что это за адрес?
 
Да, это адрес учетной записи лица, которое развернуло этот Контракт. Я развернул контракт на учетной записи, это видно в "from account", поэтому эта учетная запись сохраняется как наименование владельца переменной состояния. Да, я написал код solidity через Klaytn IDE и проверил владельца контракта. Далее мы напишем и протестируем оставшиеся две функции, это будет в следующем уроке.




 
## 4.4 Klaytn IDE и смарт контракт 2
 

Давайте продолжим создавать функцию, которая показывает, как много KLAY находятся в адресе контракта. Пожалуйста, установите флажок авто рядом с ней. Внутри конструктора мы собираемся создать функцию getBalance.
(Code)

Используется ключевое слово function, имя - «getBalance ()», видимость общедоступна, а тип - только для чтения с представлением. Наконец, определите тип uint как функцию, которая возвращает значение.
(Code)

адреса который относится к текущему контракту. Это контракт на создание игры. И доступный баланс на нем. Это завершает функцию загрузки баланса KLAY по этому адресу контракта. Давайте повторно развернем его для тестирования. Нажмите на кнопку Deploy, будет создана функция getBalance () и активирована кнопка Call. Давайте нажмем на нее один раз. Тогда текущий баланс равен нулю. Я ничего пока не отправлял.
 
 
Далее, давайте создадим функцию, которая отправляет KLAY на адрес контракта из учетной записи владельца.
(Code)

Я сделал видимость общедоступной и сделал тип платным. Всякий раз, когда вы отправляете KLAY для функции обеспечения solidity в своей учетной записи, вы всегда должны указывать этот тип как подлежащий оплате. Таким образом, я могу получить деньги от функции. Далее мы проверим правильность.
 
(Code)

Если вы не используете ключевое слово require, функция будет прекращена. msg.sender ссылается на учетную запись, которая  вызывала эту функцию, и сравнивает эту учетную запись с учетной записью владельца переменной состояния, так что если учетная запись, которая в данный момент загружает эту функцию, не является учетной записью владельца, она не будет выполнять функцию. Поэтому я провел проверку достоверности, с целью посмотреть, смогу ли я перевести KLAY со счета владельца в контракт. Теперь давайте попробуем протестировать.
 
 

Пожалуйста, нажмите кнопку Deploy. Функция депозита теперь активирована. Если вы отправляете KLAY с функцией депозита, вы должны использовать Tx.value. Если функция имеет платный тип, вы должны использовать tx.value. В поле test_KLAY введите 1 в качестве значения. Затем нажмите кнопку отправки депозита. Ваша транзакция прошла успешно и вернула подтверждение. Если вы посмотрите на поле from account, баланс уменьшится со 100 KLAY до 99 KLAY. Если бы это был рабочая сеть, нам пришлось бы вычесть остаток, включая стоимость газа, использованного для обработки транзакции, но мы выбрали узел разработки, который не включает оплату за газ.
 

Теперь давайте вызовем функцию getbalance, чтобы увидеть, сколько составляет баланс контракта. Там есть значение. Обратите внимание, что мы отправили только 1 KLAY, а число настолько велико, что вы можете запутаться. Теперь это значение 1 KLAY, преобразованное в peb, минимальную единица KLAY. В виртуальной машине Klayton вам нужно преобразовать KLAY в наименьшую единицу измерения peb и обработать ее, чтобы вы увидели это число. При вводе значения из значения tx и отправке его в функцию Deposit, к счастью, среда IDE автоматически преобразует его в наименьшую единицу, peb.
Это очень полезная функция для тестирования. И наоборот, вы также можете тестировать с разными единицами в значении tx, на этот раз с наименьшей единицей, peb. Давайте конвертируем 2 KLAY в peb и отправим в контракт. Вернитесь на сайт конвертации единиц, введите 2 KLAY, скопируйте преобразованное значение в peb и вставьте его в значение tx.
 
 
Итак, вы вызываете функцию депозита. Сделка прошла успешно. Давайте назовем функцию getbalance. Значение увеличилось. Итак, вы можете проверить работу с преобразованием единиц.
 
 

Газовый лимит - это лимит газа, который по умолчанию устанавливается автоматически. Другими словами, система рассчитывает газовый лимит для входа в функцию и автоматически определяет его. Это потому, что расчет зависит от сложности функции. Таким образом, газовый предел для функции обработки не является фиксированным. Когда мы отправляем деньги с помощью кошелька из прежнего курса, лимит газа был установлен на уровне 25000. Это просто транзакция, которая отправляет деньги, поэтому сложности нет, а лимит газа фиксирован. На самом деле, вы можете вручную ввести этот предел газа и попробовать более точный тест. Итак, мы разобрали лимит газа и покрыл часть перевода денег со счета владельца, используя стоимость транзакции для заключения контракта.
 

 
## 4.5 Klaytn IDE и смарт контракт 3
 

С помощью последней функции давайте напишем логику для перевода денег в контракте на учетную запись пользователя, когда пользователь решил задачу в игре. Для справки, пользователь, давший правильный ответ, вызывает эту функцию напрямую, с целью получить деньги.
 
Получаем значение KLAY для передачи пользователю в качестве аргумента. Обратите внимание, что это значение преобразуется из внешнего интерфейса в peb и лишь потом передается. И есть функция, которая возвращает логическое значение. Вам нужно проверить, что баланс в контракте равен значению, которое вы хотите отправить пользователю.
 

Вызовите функцию getbalance (), чтобы получить оставшийся баланс в текущем контракте и передать его, если он равен или больше значения, полученного в качестве аргумента.
 

Пользователь, ответивший правильно, вызвал эту функцию, msg.sender,
(transfer (_value)), чтобы получить призовые деньги, нужно отправить KLAY пользователю, используя функцию перевода. Посмотрим, было ли это успешно.
 

Теперь мы написали код смарт-контракта, который будем использовать. Это было очень просто, верно? Теперь давайте сделаем заключительный тест. Для развертывания установите значение Tx в 0 и установите предельное значение газа на автоматический расчет. Ваше развертывание прошло успешно. Чтобы использовать функцию переноса, мы снова отправим KLAY, поскольку остаток по контракту равен 0 после нового развертывания. Значение Tx равно 3, и я заменю Test_peb на Test_klay. Нажмите кнопку отправки в функции депозита. Если транзакция прошла успешно, нажмите «get balance», и ваши деньги поступят. Помните, что остаток на счете составляет 94 KLAY.
 
Теперь давайте используем передаточную функцию. Установите значение Tx обратно в 0 и нажмите кнопку функции отправки. Это функция, которая содержит параметры, и вы должны отправить значение аргумента, когда появится окно. Вы также должны конвертировать KLAY в peb при отправке. Помните, что значения KLAY, отправленные в контракт, преобразуются в peb. Вернитесь на сайт конвертации и конвертируйте 1 KLAY. Скопируйте и вставьте значение Peb. Нажмите кнопку call, и транзакция будет выполнена, и будет отправлено подтверждение. Баланс «From account» был увеличен на 1 KLAY. Он был 94 KLAY. Наконец, при вызове функции getbalance осталось всего 2 KLAY и уменьшилось 1 KLAY.
 

Для справки: этот узел разработки является фактически запущенным узлом, поэтому отслеживание выполненных нами транзакций будет записано в сети. Как мы проверим это? Все, что вам нужно знать, это адрес контракта. Информация под кнопкой развертывания - это адрес контракта, который мы развернули на узле dev. Скопируйте его и обновите страницу.
 

Снова нажмите кнопку компиляции и нажмите стрелку addition game. Под ней снова вставьте адрес договора. Затем функции снова активируются. Давайте назовем функцию Getbalance. Ваш баланс останется на прежнем уровне. Это просто. Если вам известен только адрес контрака, вы можете просмотреть записи, которые я проверял. Итак, мы изучали развертывание и тестирование игры с помощью Klaytn IDE.


